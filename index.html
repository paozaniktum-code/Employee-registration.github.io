<!doctype html>
<html lang="th">
<head>
  <meta charset="UTF-8" />
  <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://cdn.jsdelivr.net/npm/xlsx/dist/xlsx.full.min.js"></script>
</head>
<body class="bg-gray-100 p-4">

<div class="max-w-7xl mx-auto bg-white shadow rounded-xl p-4">

  <!-- NAV -->
  <div class="flex justify-between items-center mb-4">
    <h1 class="text-xl font-bold">üìã ‡∏£‡∏∞‡∏ö‡∏ö‡∏•‡∏á‡∏ó‡∏∞‡πÄ‡∏ö‡∏µ‡∏¢‡∏ô‡∏Å‡∏∞‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>
    <div class="flex gap-2">
      <button onclick="showPage('list')" class="px-3 py-2 bg-gray-200 rounded">‡∏î‡∏π‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•</button>
      <button onclick="showPage('add')" class="px-3 py-2 bg-blue-600 text-white rounded">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
      <button id="export-btn" class="px-3 py-2 bg-green-600 text-white rounded">Export Excel</button>
    </div>
  </div>

  <!-- PAGE: LIST -->
  <div id="page-list">
    <div class="overflow-x-auto">
      <table class="min-w-full border text-sm">
        <thead class="bg-gray-100">
          <tr>
            <th class="border px-2">‡∏ä‡∏∑‡πà‡∏≠</th>
            <th class="border px-2">D Rate</th>
            <th class="border px-2">N Rate</th>
            <th class="border px-2">‡πÄ‡∏ß‡∏£</th>
            <th class="border px-2">‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á</th>
            <th class="border px-2">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
            <th class="border px-2">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
          </tr>
        </thead>
        <tbody id="employee-body"></tbody>
      </table>
    </div>
    <div id="monthly-summary" class="mt-4 font-semibold"></div>
  </div>

  <!-- PAGE: ADD -->
  <div id="page-add" class="hidden">
    <div class="grid md:grid-cols-2 gap-4">
      <input id="name" placeholder="‡∏ä‡∏∑‡πà‡∏≠‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô" class="border p-2 rounded" />
      <input id="rateD" type="number" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á D" class="border p-2 rounded" />
      <input id="rateN" type="number" placeholder="‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á N" class="border p-2 rounded" />
      <input id="shifts" placeholder="‡πÄ‡∏ß‡∏£ ‡πÄ‡∏ä‡πà‡∏ô D,N,D,,N" class="border p-2 rounded md:col-span-2" />
    </div>
    <button onclick="addEmployee()" class="mt-4 px-4 py-2 bg-blue-600 text-white rounded">‡∏ö‡∏±‡∏ô‡∏ó‡∏∂‡∏Å</button>
  </div>

</div>

<script>
let employees = JSON.parse(localStorage.getItem('employees')) || [];

function save(){ localStorage.setItem('employees', JSON.stringify(employees)); }

function showPage(page){
  document.getElementById('page-list').classList.toggle('hidden', page !== 'list');
  document.getElementById('page-add').classList.toggle('hidden', page !== 'add');
}

function parseShifts(s){ return s.split(','); }
function calculateShiftCount(sh){ return sh.filter(x=>x==='D'||x==='N').length; }
function calculateTotalWage(sh,d,n){ return sh.reduce((sum,x)=>x==='D'?sum+d:x==='N'?sum+n:sum,0); }
function calculateRemaining(emp,sh){ return calculateTotalWage(sh,emp.day_rate_d,emp.day_rate_n); }

function render(){
  const tbody=document.getElementById('employee-body'); tbody.innerHTML='';
  employees.forEach((e,i)=>{
    const sh=parseShifts(e.shifts);
    const tr=document.createElement('tr');
    tr.innerHTML=`
      <td class="border px-2">${e.employee_name}</td>
      <td class="border px-2 text-right">${e.day_rate_d}</td>
      <td class="border px-2 text-right">${e.day_rate_n}</td>
      <td class="border px-2 text-center">${calculateShiftCount(sh)}</td>
      <td class="border px-2 text-right">${calculateTotalWage(sh,e.day_rate_d,e.day_rate_n)}</td>
      <td class="border px-2 text-right">${calculateRemaining(e,sh)}</td>
      <td class="border px-2 text-center">
        <button onclick="removeEmployee(${i})" class="text-red-600">‡∏•‡∏ö</button>
      </td>`;
    tbody.appendChild(tr);
  });
  document.getElementById('monthly-summary').innerText = `‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô‡∏ó‡∏±‡πâ‡∏á‡∏´‡∏°‡∏î ${employees.length} ‡∏Ñ‡∏ô`;
}

function addEmployee(){
  employees.push({
    employee_name: name.value,
    day_rate_d: +rateD.value,
    day_rate_n: +rateN.value,
    shifts: shifts.value
  });
  save(); render(); showPage('list');
}

function removeEmployee(i){ if(confirm('‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô?')){ employees.splice(i,1); save(); render(); } }

function exportExcel(){
  const data=employees.map((e,i)=>({
    ‡∏•‡∏≥‡∏î‡∏±‡∏ö:i+1,‡∏ä‡∏∑‡πà‡∏≠:e.employee_name,‡πÄ‡∏ß‡∏£:calculateShiftCount(parseShifts(e.shifts)),
    ‡∏Ñ‡πà‡∏≤‡πÅ‡∏£‡∏á:calculateTotalWage(parseShifts(e.shifts),e.day_rate_d,e.day_rate_n)
  }));
  const ws=XLSX.utils.json_to_sheet(data);
  const wb=XLSX.utils.book_new();
  XLSX.utils.book_append_sheet(wb,ws,'Payroll');
  XLSX.writeFile(wb,'payroll.xlsx');
}

document.getElementById('export-btn').onclick=exportExcel;
render();
</script>
</body>
</html>
