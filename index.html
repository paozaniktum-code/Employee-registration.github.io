<!doctype html>
<html lang="th">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡∏£‡∏∞‡∏ö‡∏ö‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏™‡∏≤‡∏Ç‡∏≤‡πÅ‡∏•‡∏∞‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Sarabun:wght@400;600;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Sarabun', sans-serif; background-color: #f1f5f9; }
        .table-wrapper { overflow: auto; max-height: 65vh; border-radius: 10px; background: white; }
        table { border-collapse: separate; border-spacing: 0; width: 100%; }
        th { position: sticky; top: 0; z-index: 20; padding: 12px 8px; color: white; font-size: 13px; text-align: center; }
        .sticky-col { position: sticky; left: 0; z-index: 30; background: #1e3a8a !important; }
        .shift-cell { min-width: 32px; height: 35px; border: 1px solid #e2e8f0; display: flex; align-items: center; justify-content: center; font-size: 11px; cursor: pointer; font-weight: bold; }
        .shift-d { background: #fef3c7; color: #92400e; }
        .shift-x { background: #fecaca; color: #b91c1c; }
        
        /* ‡∏™‡πÑ‡∏ï‡∏•‡πå‡∏™‡∏≥‡∏´‡∏£‡∏±‡∏ö Report ‡πÄ‡∏ó‡πà‡∏≤‡∏ô‡∏±‡πâ‡∏ô */
        #report-section { display: none; }
        @media print {
            .no-print { display: none !important; }
            #report-section { display: block !important; }
            #main-app { display: none !important; }
            @page { size: landscape; margin: 1cm; }
            table { font-size: 12px; border: 1px solid black; }
            th, td { border: 1px solid black !important; padding: 5px !important; color: black !important; }
        }
    </style>
</head>
<body class="p-4">

    <div id="branch-select" class="max-w-md mx-auto mt-20 bg-white p-8 rounded-3xl shadow-xl no-print">
        <h1 class="text-2xl font-bold text-center mb-6 text-blue-900">‡πÄ‡∏•‡∏∑‡∏≠‡∏Å‡∏™‡∏≤‡∏Ç‡∏≤‡πÄ‡∏û‡∏∑‡πà‡∏≠‡πÄ‡∏£‡∏¥‡πà‡∏°‡∏á‡∏≤‡∏ô</h1>
        <div class="grid grid-cols-2 gap-4">
            <button onclick="startApp(1)" class="p-6 bg-blue-600 text-white rounded-2xl font-bold hover:bg-blue-700 transition">üè¢ ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 1</button>
            <button onclick="startApp(2)" class="p-6 bg-emerald-600 text-white rounded-2xl font-bold hover:bg-emerald-700 transition">üè¨ ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà 2</button>
        </div>
    </div>

    <div id="main-app" class="hidden no-print">
        <div class="flex justify-between items-center mb-4">
            <h2 id="app-title" class="text-xl font-bold text-blue-900"></h2>
            <div class="flex gap-2">
                <button onclick="location.reload()" class="bg-gray-200 px-4 py-2 rounded-lg text-sm font-bold">üè† ‡πÄ‡∏õ‡∏•‡∏µ‡πà‡∏¢‡∏ô‡∏™‡∏≤‡∏Ç‡∏≤</button>
                <button onclick="prepareReport()" class="bg-emerald-600 text-white px-6 py-2 rounded-lg font-bold shadow-lg hover:bg-emerald-700 transition">üìä ‡∏≠‡∏≠‡∏Å‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô</button>
            </div>
        </div>

        <div class="table-wrapper border shadow-sm mb-6">
            <table>
                <thead class="bg-blue-900">
                    <tr>
                        <th class="sticky-col border-r border-blue-800">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                        <th class="sticky-col left-[50px] border-r border-blue-800" style="min-width: 150px;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                        <th class="border-r border-blue-800">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</th>
                        <th id="days-header" class="p-0">‡∏ß‡∏±‡∏ô‡∏ó‡∏µ‡πà (1-31)</th>
                        <th class="bg-slate-700 px-4">‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£</th>
                    </tr>
                </thead>
                <tbody id="data-tbody"></tbody>
            </table>
        </div>
        
        <form id="add-form" class="bg-white p-4 rounded-xl border flex gap-2 items-end flex-wrap">
            <div><label class="block text-xs font-bold mb-1">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</label><input type="text" id="in-name" required class="border p-2 rounded w-40"></div>
            <div><label class="block text-xs font-bold mb-1">‡∏ï‡∏≥‡πÅ‡∏´‡∏ô‡πà‡∏á</label><input type="text" id="in-pos" required class="border p-2 rounded w-32"></div>
            <div><label class="block text-xs font-bold mb-1">‡∏õ‡∏£‡∏∞‡πÄ‡∏†‡∏ó</label><select id="in-type" class="border p-2 rounded"><option value="monthly">‡∏£‡∏≤‡∏¢‡πÄ‡∏î‡∏∑‡∏≠‡∏ô</option><option value="daily">‡∏£‡∏≤‡∏¢‡∏ß‡∏±‡∏ô</option></select></div>
            <div><label class="block text-xs font-bold mb-1">‡πÄ‡∏á‡∏¥‡∏ô‡πÄ‡∏î‡∏∑‡∏≠‡∏ô/‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</label><input type="number" id="in-salary" required class="border p-2 rounded w-28"></div>
            <button type="submit" class="bg-blue-600 text-white px-6 py-2 rounded-lg font-bold">‡πÄ‡∏û‡∏¥‡πà‡∏°‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</button>
        </form>
    </div>

    <div id="report-section">
        <div class="text-center mb-6">
            <h1 class="text-2xl font-bold">‡∏™‡∏£‡∏∏‡∏õ‡∏£‡∏≤‡∏¢‡∏á‡∏≤‡∏ô‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô</h1>
            <p id="report-date-label"></p>
        </div>
        <table class="w-full border-collapse">
            <thead>
                <tr>
                    <th class="bg-slate-700">‡∏•‡∏≥‡∏î‡∏±‡∏ö</th>
                    <th class="bg-slate-700" style="text-align: left;">‡∏ä‡∏∑‡πà‡∏≠-‡∏ô‡∏≤‡∏°‡∏™‡∏Å‡∏∏‡∏•</th>
                    <th class="bg-[#4f46e5]">‡∏£‡∏ß‡∏°‡∏Ñ‡πà‡∏≤‡∏à‡πâ‡∏≤‡∏á</th>
                    <th class="bg-[#3b82f6]">‡πÇ‡∏≠‡∏ó‡∏µ</th>
                    <th class="bg-[#ef4444]">‡∏´‡∏¢‡∏∏‡∏î</th>
                    <th class="bg-[#3b82f6]">%‡∏Ç‡∏≤‡∏¢</th>
                    <th class="bg-[#3b82f6]">‡∏à‡∏ö‡πÄ‡∏Ñ‡∏™</th>
                    <th class="bg-[#f97316]">‡∏Ñ‡πà‡∏≤‡∏ä‡∏∏‡∏î</th>
                    <th class="bg-[#f97316]">‡∏Ñ‡πà‡∏≤‡πÄ‡∏£‡∏µ‡∏¢‡∏ô</th>
                    <th class="bg-[#f97316]">‡∏Ñ‡πà‡∏≤‡∏ô‡πâ‡∏≥/‡πÑ‡∏ü</th>
                    <th class="bg-[#f97316]">‡∏ú‡∏¥‡∏î‡∏Å‡∏è</th>
                    <th class="bg-[#f97316]">‡∏≠‡∏∑‡πà‡∏ô‡πÜ</th>
                    <th class="bg-[#059669]">‡∏Ñ‡∏á‡πÄ‡∏´‡∏•‡∏∑‡∏≠</th>
                </tr>
            </thead>
            <tbody id="report-tbody"></tbody>
        </table>
    </div>

    <script>
        let branchId = 0;
        let employees = [];
        const mNames = ["‡∏°‡∏Å‡∏£‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏∏‡∏°‡∏†‡∏≤‡∏û‡∏±‡∏ô‡∏ò‡πå","‡∏°‡∏µ‡∏ô‡∏≤‡∏Ñ‡∏°","‡πÄ‡∏°‡∏©‡∏≤‡∏¢‡∏ô","‡∏û‡∏§‡∏©‡∏†‡∏≤‡∏Ñ‡∏°","‡∏°‡∏¥‡∏ñ‡∏∏‡∏ô‡∏≤‡∏¢‡∏ô","‡∏Å‡∏£‡∏Å‡∏é‡∏≤‡∏Ñ‡∏°","‡∏™‡∏¥‡∏á‡∏´‡∏≤‡∏Ñ‡∏°","‡∏Å‡∏±‡∏ô‡∏¢‡∏≤‡∏¢‡∏ô","‡∏ï‡∏∏‡∏•‡∏≤‡∏Ñ‡∏°","‡∏û‡∏§‡∏®‡∏à‡∏¥‡∏Å‡∏≤‡∏¢‡∏ô","‡∏ò‡∏±‡∏ô‡∏ß‡∏≤‡∏Ñ‡∏°"];

        function startApp(id) {
            branchId = id;
            document.getElementById('branch-select').style.display = 'none';
            document.getElementById('main-app').classList.remove('hidden');
            document.getElementById('app-title').textContent = `‡∏Å‡∏≤‡∏£‡∏à‡∏±‡∏î‡∏Å‡∏≤‡∏£‡∏Ç‡πâ‡∏≠‡∏°‡∏π‡∏•: ‡∏™‡∏≤‡∏Ç‡∏≤‡∏ó‡∏µ‡πà ${id}`;
            employees = JSON.parse(localStorage.getItem(`br_${id}_data`) || '[]');
            renderDays();
            renderTable();
        }

        function renderDays() {
            let h = '<div class="flex">';
            for(let i=1; i<=31; i++) h += `<div class="shift-cell w-[32px] flex-none bg-blue-800 text-white border-blue-700">${i}</div>`;
            document.getElementById('days-header').innerHTML = h + '</div>';
        }

        function renderTable() {
            const tbody = document.getElementById('data-tbody');
            tbody.innerHTML = '';
            employees.forEach((emp, idx) => {
                const tr = document.createElement('tr');
                tr.innerHTML = `
                    <td class="sticky-col border-b text-center font-bold bg-gray-50">${idx+1}</td>
                    <td class="sticky-col left-[50px] border-b px-3 bg-white font-bold">${emp.name}</td>
                    <td class="border-b px-3 text-sm text-gray-500">${emp.pos}</td>
                    <td class="border-b p-0"><div class="flex">${generateShifts(emp)}</div></td>
                    <td class="border-b text-center px-4"><button onclick="delEmp(${idx})" class="text-red-400 font-bold">‡∏•‡∏ö</button></td>
                `;
                tbody.appendChild(tr);
            });
            localStorage.setItem(`br_${branchId}_data`, JSON.stringify(employees));
        }

        function generateShifts(emp) {
            let h = '';
            for(let i=0; i<31; i++) {
                const s = emp.shifts[i] || '';
                h += `<div onclick="toggleShift(${employees.indexOf(emp)}, ${i})" class="shift-cell flex-none ${s==='D'?'shift-d':s==='X'?'shift-x':''}">${s}</div>`;
            }
            return h;
        }

        function toggleShift(eIdx, dIdx) {
            const cycle = ['', 'D', 'X'];
            let cur = cycle.indexOf(employees[eIdx].shifts[dIdx]);
            employees[eIdx].shifts[dIdx] = cycle[(cur + 1) % cycle.length];
            renderTable();
        }

        document.getElementById('add-form').onsubmit = (e) => {
            e.preventDefault();
            employees.push({
                name: document.getElementById('in-name').value,
                pos: document.getElementById('in-pos').value,
                type: document.getElementById('in-type').value,
                salary: parseFloat(document.getElementById('in-salary').value),
                shifts: Array(31).fill(''),
                money: { ot:0, com:0, case:0, unif:0, lear:0, util:0, fine:0, othe:0 }
            });
            e.target.reset(); renderTable();
        }

        function prepareReport() {
            const rBody = document.getElementById('report-tbody');
            rBody.innerHTML = '';
            employees.forEach((emp, idx) => {
                let units = emp.shifts.filter(s => s === 'D').length;
                let off = emp.shifts.filter(s => s === 'X').length;
                let wage = emp.type === 'daily' ? units * emp.salary : (units/26) * emp.salary;
                let net = wage + (emp.money.ot || 0) + (emp.money.com || 0) + (emp.money.case || 0) 
                          - (emp.money.unif || 0) - (emp.money.lear || 0) - (emp.money.util || 0) 
                          - (emp.money.fine || 0) - (emp.money.othe || 0);

                rBody.innerHTML += `
                    <tr>
                        <td style="text-align:center">${idx+1}</td>
                        <td>${emp.name}</td>
                        <td style="text-align:right">${fmt(wage)}</td>
                        <td style="text-align:right">${fmt(emp.money.ot)}</td>
                        <td style="text-align:center">${off}</td>
                        <td style="text-align:right">${fmt(emp.money.com)}</td>
                        <td style="text-align:right">${fmt(emp.money.case)}</td>
                        <td style="text-align:right">${fmt(emp.money.unif)}</td>
                        <td style="text-align:right">${fmt(emp.money.lear)}</td>
                        <td style="text-align:right">${fmt(emp.money.util)}</td>
                        <td style="text-align:right">${fmt(emp.money.fine)}</td>
                        <td style="text-align:right">${fmt(emp.money.othe)}</td>
                        <td style="text-align:right; font-weight:bold">${fmt(net)}</td>
                    </tr>
                `;
            });
            window.print();
        }

        function delEmp(i) { if(confirm('‡∏•‡∏ö‡∏û‡∏ô‡∏±‡∏Å‡∏á‡∏≤‡∏ô?')) { employees.splice(i, 1); renderTable(); } }
        function fmt(n) { return (n || 0).toLocaleString(); }
    </script>
</body>
</html>
